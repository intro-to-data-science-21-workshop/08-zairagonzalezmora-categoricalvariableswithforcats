---
title: "Workshop 8. Categorical Variables with forcats"
subtitle: "Working with factors - Exercises"
author: "Zaira Gonzalez Mora & Luka Vasilj"
output: 
  html_document:
    toc: TRUE
    df_print: paged
    number_sections: FALSE
    highlight: tango
    theme: lumen
    toc_depth: 3
    toc_float: true
    self_contained: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE, 
                      warning = FALSE)

```

```{r setup, include=FALSE}
#Packages
library(forcats)
library(tidyverse)
ds <- gss_cat
```

Now that we've gone through the basics, let's put this to practice!

1) First, let's try to make a factor out of the days of the week. As you can see from the base R `as.factor()` function below, the factor may have been created, but the levels within it are listed alphabetically - not particularly useful if you want to have the days of the week in order.

```{r}
day_of_week <- c("Monday", "Tuesday", "Wednesday", "Thursday", 
                 "Friday", "Saturday", "Sunday")

day_of_week_fct <- as.factor(day_of_week)

day_of_week_fct
```
a) Let's try creating a factor using the `factor(f, levels = x)` function. The function takes two arguments: the factor itself, typically a column in your dataset; and a list containing the levels of that factor.

```{r}
week <- c(sample(day_of_week, 40, replace = T))


```

b) Now you're magically teleported to the Middle East, where Friday and Saturday are the weekend, and Sunday happens to be the first day of the week. Use the `fct_relevel(f, )` function to reorganize the levels. The function takes two arguments: the factor you want releveled, and a list containing the newly ordered levels. (Hint: it's pretty much identical to creating a factor, except you can only perform this on an existing factor as the first argument)

```{r}

```

Likewise, if we want to check all the levels that are stored in a factor (as not all factors might appear in a sample) is `levels()`.

There are plenty of other functions used to reorder factors:
- `fct_rev()` reverses the order of the levels in the factor.
- `fct_infreq()` orders the levels according to the frequency in which they appear.
- `fct_inorder()` orders the levels in the order in which they appear.
- `fct_shift()` shifts the levels of a factor by one to each side.
- `fct_shuffle()` randomizes the levels of a factor.

## The GSS database and **`forcats`** `r emo::ji("cat")`

2) The forcats package already has a built-in dataset from the General Social Survey that can be called with `gss_cat`. This dataset was crafted specifically for the purpose of getting to know the forcats package, and contains categorical variables already transformed into factors. Let's load the dataset and practice the other functions from the package. #levels(df$INCOME)

a) First, let's take a look at the factors already present in the dataset (six out of the nine columns are factors). Using the `levels()` function, we can take a look at the levels in each factor. From the six variables, are there any that are perhaps too detailed and could be collapsed into smaller groups?

```{r}

```

b) The partyid variable might be a little too detailed for visualization purposes. Let's collapse the levels in this factor into more aggregated groups: Democrats, Independents, Republicans, and Other using the `fct_collapse()` function. To preserve the original categorization, create a new variable in the dataset and assign it the new factor.

```{r}

```

c) The denom variable lists the denominations of Protestant respondents. However, there are again too many different levels for it to be easily visually interpretable. Using `fct_lump()`, try creating a new dataset containing only those respondents that are Protestant, leaving only the top 5 denominations - the remainder will be lumped into "Other". `fct_lump()` takes two arguments: the first is your factor, the second is `n = ` followed by the number of top categories you want to remain.

```{r}

```


d)i) Using the above dataset listing the denominations, let us try to see which of the denominations watches tv the most, on average, and plot it in a bar graph. 

```{r}

```

ii) The plot, while accurate, doesn't order the levels of the factor in a visually appealing way. Forcats to the rescue! We can order the factors according to their relationship with another variable using `fct_reorder()`, which takes two arguments: the factor we want reordered, and the variable according to which we want it reordered.

```{r}

```

And that's that!

Forcats let's us play around with factors in an easily accessible way, allowing us to manipulate categorical variables while still adhering to tidy principles! 

These exercises showed the basics, but in case of any doubt (or if you want to learn more), please consult the cheatsheet found here by blah blah.
